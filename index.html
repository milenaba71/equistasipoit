<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Dolore + mappe dermatomeri + punti guidati</title>
  <style>
    :root{
      --blue:#1f5eff;
      --bg:#f6f7fb;
      --card:#ffffff;
      --line:#d9dce6;
      --soft:#eef1ff;
      --text:#111;
      --muted:#555;
    }
    body{font-family:system-ui;margin:0;background:var(--bg);color:var(--text)}
    .wrap{max-width:1200px;margin:0 auto;padding:18px}
    .card{background:var(--card);border-radius:16px;padding:18px;box-shadow:0 6px 18px rgba(0,0,0,.06)}
    h2{margin:0 0 6px}
    .small{font-size:12px;color:var(--muted);line-height:1.35}
    .row{display:grid;grid-template-columns:1fr;gap:12px}
    @media(min-width:980px){.row.two{grid-template-columns:1.05fr .95fr}}
    label{font-size:13px;color:#333;display:block;margin-bottom:6px}
    select,input,textarea{width:100%;padding:10px 12px;border:1px solid var(--line);border-radius:12px;font-size:16px;background:#fff}
    textarea{min-height:90px;resize:vertical}
    .btnbar{display:flex;gap:10px;margin-top:14px;flex-wrap:wrap}
    button{appearance:none;border:0;border-radius:12px;padding:10px 14px;font-size:16px;cursor:pointer}
    button.primary{background:var(--blue);color:#fff}
    button.secondary{background:var(--soft);color:var(--blue)}
    button.ghost{background:transparent;color:var(--blue);border:1px solid #cfd6ff}
    .pill{display:inline-block;background:var(--soft);color:var(--blue);padding:4px 10px;border-radius:999px;font-size:12px;margin-bottom:10px}
    .progress{height:10px;background:#e9ecf7;border-radius:999px;overflow:hidden;margin:12px 0 16px}
    .bar{height:100%;width:0%;background:var(--blue);transition:width .25s ease}

    .step{display:none}
    .step.active{display:block}

    .zones{display:grid;grid-template-columns:1fr;gap:10px;margin-top:10px}
    @media(min-width:980px){.zones{grid-template-columns:1fr 1fr}}
    .zoneBtn{width:100%;text-align:left;border:1px solid var(--line);background:#fff;border-radius:14px;padding:12px}
    .zoneBtn b{display:block;margin-bottom:6px}
    .zoneBtn small{color:#555}
    .zoneBtn.selected{border-color:var(--blue);box-shadow:0 0 0 3px rgba(31,94,255,.15)}

    .result{background:#f7f9ff;border:1px solid #dfe6ff;padding:12px;border-radius:12px;white-space:pre-wrap}
    .warn{background:#fff5f5;border:1px solid #ffd6d6;color:#7a1b1b;padding:12px;border-radius:12px;margin-top:12px}

    .mapBox{border:1px solid #e6e8f2;border-radius:16px;padding:12px;background:#fff}
    .mapGrid{display:grid;grid-template-columns:1fr;gap:12px}
    @media(min-width:980px){.mapGrid{grid-template-columns:1fr 1fr}}
    .pane{border:1px solid #eef1ff;border-radius:16px;padding:10px;background:#fbfcff}
    .pane b{display:block;margin-bottom:6px}

    .imgWrap{position:relative;border-radius:14px;overflow:hidden;border:1px solid rgba(0,0,0,.06);background:#fff}
    .imgWrap img{width:100%;height:auto;display:block}
    .imgErr{display:none;padding:10px;font-size:12px;color:#7a1b1b;background:#fff5f5;border-top:1px solid #ffd6d6}

    .marker{
      position:absolute;
      transform:translate(-50%,-50%);
      display:none;
      z-index:3;
      pointer-events:auto;   /* <- cliccabile */
      cursor:pointer;
      user-select:none;
      -webkit-user-select:none;
      touch-action:none;
    }
    .marker.show{display:block}
    .dot{
      width:14px;height:14px;border-radius:50%;
      background:var(--blue);
      box-shadow:0 0 0 4px rgba(31,94,255,.18);
      border:2px solid #fff;
    }
    .label{
      margin-top:6px;
      background:rgba(255,255,255,.96);
      border:1px solid rgba(0,0,0,.08);
      border-radius:12px;
      padding:6px 8px;
      font-size:12px;
      color:#111;
      box-shadow:0 6px 18px rgba(0,0,0,.08);
      max-width:300px;
    }
    .label small{display:block;color:#555;font-size:11px;margin-top:2px;white-space:normal}

    .modalBack{
      position:fixed; inset:0; background:rgba(0,0,0,.35);
      display:none; align-items:center; justify-content:center; padding:18px; z-index:50;
    }
    .modal{
      max-width:760px; width:100%;
      background:#fff; border-radius:16px; padding:14px;
      box-shadow:0 20px 60px rgba(0,0,0,.25);
    }
    .modalHeader{display:flex;align-items:center;justify-content:space-between;gap:10px}
    .modalHeader b{font-size:16px}
    .closeBtn{background:transparent;border:1px solid #ddd;border-radius:10px;padding:6px 10px;font-size:14px;cursor:pointer}
    .modalBody{margin-top:10px;color:#222;line-height:1.45;font-size:14px}
    .chips{display:flex;gap:8px;flex-wrap:wrap;margin:10px 0}
    .chip{background:var(--soft);color:var(--blue);padding:4px 10px;border-radius:999px;font-size:12px}
  </style>
</head>

<body>
<div class="wrap">
  <div class="card">
    <h2>Demo — dolore + mappe dermatomeri + punti guidati</h2>
    <div class="small">
      Demo informativa. Non è diagnosi. Tocca i marker per vedere la scheda del punto.
    </div>

    <div class="progress"><div class="bar" id="bar"></div></div>

    <!-- STEP 1 -->
    <section class="step active" id="step1">
      <div class="pill">Passo 1/4</div>
      <p><b>Dove senti dolore?</b></p>

      <div class="row two">
        <div>
          <label>Area</label>
          <select id="area">
            <option value="">Seleziona…</option>
            <option value="ginocchio">Ginocchio</option>
            <option value="anca">Anca / regione inguinale</option>
            <option value="lombare">Schiena bassa (lombare)</option>
            <option value="cervicale">Collo (cervicale)</option>
            <option value="spalla">Spalla</option>
            <option value="mano">Mano / dita</option>
          </select>
        </div>
        <div>
          <label>Lato</label>
          <select id="side">
            <option value="">Seleziona…</option>
            <option value="sinistro">Sinistro</option>
            <option value="destro">Destro</option>
            <option value="bilaterale">Bilaterale</option>
            <option value="centrale">Centrale</option>
          </select>
        </div>
      </div>

      <div class="btnbar">
        <button class="primary" type="button" id="btnNext1">Avanti</button>
      </div>
    </section>

    <!-- STEP 2 -->
    <section class="step" id="step2">
      <div class="pill">Passo 2/4</div>
      <p><b>Seleziona la zona più precisa</b></p>
      <div class="zones" id="zones"></div>

      <div class="btnbar">
        <button class="secondary" type="button" id="btnBack2">Indietro</button>
        <button class="primary" type="button" id="btnNext2">Avanti</button>
      </div>
    </section>

    <!-- STEP 3 -->
    <section class="step" id="step3">
      <div class="pill">Passo 3/4</div>
      <p><b>Dettagli</b></p>

      <div class="row two">
        <div>
          <label>Intensità (0–10)</label>
          <input id="intensity" type="number" min="0" max="10" step="1" placeholder="Es. 6"/>
        </div>
        <div>
          <label>Da quanto tempo?</label>
          <select id="duration">
            <option value="">Seleziona…</option>
            <option value="<24h">Meno di 24 ore</option>
            <option value="1-3g">1–3 giorni</option>
            <option value="4-14g">4–14 giorni</option>
            <option value=">2s">Oltre 2 settimane</option>
            <option value=">3m">Oltre 3 mesi</option>
          </select>
        </div>
      </div>

      <div class="row">
        <div>
          <label>Note (facoltativo)</label>
          <textarea id="notes" placeholder="Cosa lo peggiora o migliora?"></textarea>
        </div>
      </div>

      <div class="btnbar">
        <button class="secondary" type="button" id="btnBack3">Indietro</button>
        <button class="primary" type="button" id="btnNext3">Vedi guida</button>
      </div>
    </section>

    <!-- STEP 4 -->
    <section class="step" id="step4">
      <div class="pill">Passo 4/4</div>
      <p><b>Guida (marker cliccabili + riferimento anatomico)</b></p>

      <div class="row two">
        <div>
          <div class="result" id="summary"></div>
          <div class="warn" id="safety" style="display:none;"></div>

          <div class="btnbar">
            <button class="ghost" type="button" id="btnRestart">Ricomincia</button>
            <button class="primary" type="button" id="btnCopy">Copia testo</button>
          </div>

          <div class="small" style="margin-top:10px;">
            <b>Riferimento palpatorio L4–L5:</b><br/>
            linea tra le <b>creste iliache</b> ≈ <b>L4</b>. Lo spazio <b>L4–L5</b> è subito sotto il processo spinoso di L4.
          </div>
        </div>

        <div class="mapBox">
          <div class="mapGrid">

            <div class="pane">
              <b>Mappa dermatomeri (vista automatica)</b>
              <div class="imgWrap" id="wrapDerm">
                <img id="imgDerm" alt="Mappa dermatomeri">
              </div>
            </div>

            <div class="pane">
              <b>Colonna vertebrale (immagine dal repo)</b>
              <div class="imgWrap" id="wrapSpine">
                <img id="imgSpine" alt="Colonna vertebrale">
                <div class="imgErr" id="spineErr">
                  Immagine colonna non trovata. Controlla che nel repo esista <b>colonna L4 L5.png</b> nella stessa cartella di index.html.
                </div>
              </div>
            </div>

            <div class="pane">
              <b>Arti inferiori (zona dolore)</b>
              <div class="imgWrap" id="wrapLower">
                <img id="imgLower" alt="Dermatomeri arti inferiori">
              </div>
            </div>

            <div class="pane">
              <b>Arti superiori (zona dolore)</b>
              <div class="imgWrap" id="wrapUpper">
                <img id="imgUpper" alt="Dermatomeri arti superiori">
              </div>
            </div>

          </div>
        </div>
      </div>
    </section>

  </div>
</div>

<!-- MODALE -->
<div class="modalBack" id="modalBack" role="dialog" aria-modal="true">
  <div class="modal">
    <div class="modalHeader">
      <b id="modalTitle">Dettaglio punto</b>
      <button class="closeBtn" id="modalClose" type="button">Chiudi</button>
    </div>
    <div class="chips" id="modalChips"></div>
    <div class="modalBody" id="modalBody"></div>
  </div>
</div>

<script>
/* ========= Helpers ========= */
const $ = (id)=>document.getElementById(id);

function showStep(n){
  ["step1","step2","step3","step4"].forEach((s,i)=>$(s).classList.toggle("active", i===n-1));
  $("bar").style.width = (((n-1)/3)*100) + "%";
}

function openModal(meta){
  $("modalTitle").textContent = meta.title || "Dettaglio";
  const chips = $("modalChips");
  chips.innerHTML = "";
  (meta.chips||[]).forEach(c=>{
    const s = document.createElement("span");
    s.className = "chip";
    s.textContent = c;
    chips.appendChild(s);
  });
  $("modalBody").innerHTML = meta.bodyHtml || "";
  $("modalBack").style.display = "flex";
}
function closeModal(){ $("modalBack").style.display="none"; }

/* ========= Stato ========= */
const STATE = { area:"", side:"", zone:"", zoneLabel:"", intensity:"", duration:"", notes:"", plan:null };

/* ========= Zone ========= */
const ZONES = {
  ginocchio: [
    ["mediale","Ginocchio interno (mediale)","dolore lato interno"],
    ["laterale","Ginocchio esterno (laterale)","dolore lato esterno"],
    ["anteriore","Ginocchio anteriore (rotula)","dolore davanti"],
    ["posteriore","Ginocchio posteriore (cavo popliteo)","dolore dietro"]
  ],
  anca: [
    ["inguine","Inguine / anteriore","dolore davanti anca"],
    ["laterale","Laterale (trocantere)","dolore lato anca"],
    ["gluteo","Gluteo / posteriore","dolore dietro anca"]
  ],
  lombare: [
    ["centrale","Centrale","dolore in mezzo"],
    ["paravertebrale","Paravertebrale","dolore a lato colonna"],
    ["sacroiliaca","Sacro-iliaca","dolore su articolazione SI"]
  ],
  cervicale: [
    ["occipite","Occipite / nuca alta","dolore alto"],
    ["bassa","Cervicale bassa","dolore base collo"],
    ["scapolare","Scapolare","dolore tra collo e scapola"]
  ],
  spalla: [
    ["anteriore","Anteriore","dolore davanti spalla"],
    ["laterale","Laterale (deltoide)","dolore sulla spalla"],
    ["posteriore","Posteriore","dolore dietro spalla"]
  ],
  mano: [
    ["pollice","Pollice","dolore pollice"],
    ["indice","Indice","dolore indice"],
    ["medio","Medio","dolore dito medio"],
    ["ulnare","Anulare/Mignolo","dolore lato ulnare"]
  ]
};

function renderZones(area){
  const box = $("zones");
  box.innerHTML = "";
  (ZONES[area]||[]).forEach(([val,label,hint])=>{
    const btn = document.createElement("button");
    btn.type="button";
    btn.className="zoneBtn";
    btn.dataset.zone=val;
    btn.innerHTML = `<b>${label}</b><small>${hint}</small>`;
    btn.addEventListener("click", ()=>{
      STATE.zone=val; STATE.zoneLabel=label;
      [...box.querySelectorAll(".zoneBtn")].forEach(b=>b.classList.toggle("selected", b.dataset.zone===val));
    });
    box.appendChild(btn);
  });
}

/* ========= Immagini ========= */
/* Qui evitiamo problemi con spazi: new URL("colonna L4 L5.png", location.href) encode automaticamente */
const IMG = {
  derm_front: "https://www.laguardiamedica.it/2019/contenuti/neurologia/images/derm_01.jpg",
  derm_back:  "https://www.laguardiamedica.it/2019/contenuti/neurologia/images/derm_02.jpg",
  derm_upper: "https://www.laguardiamedica.it/2019/contenuti/neurologia/images/derm_03.jpg",
  derm_lower: "https://www.laguardiamedica.it/2019/contenuti/neurologia/images/derm_04.jpg",
  spine:      new URL("colonna L4 L5.png", window.location.href).href
};

function setMapImages(dermView){
  const dermSrc =
    dermView==="front" ? IMG.derm_front :
    dermView==="upper" ? IMG.derm_upper :
    dermView==="lower" ? IMG.derm_lower :
    IMG.derm_back;

  $("imgDerm").src  = dermSrc;
  $("imgLower").src = IMG.derm_lower;
  $("imgUpper").src = IMG.derm_upper;

  // colonna: mostra errore se non trova
  $("spineErr").style.display = "none";
  $("imgSpine").onerror = ()=>{ $("spineErr").style.display="block"; };
  $("imgSpine").src = IMG.spine;
}

/* ========= Marker coordinate (default) ========= */
const POS = {
  spine_L4L5:{wrap:"spine", left:26, top:78},
  spine_S1:{wrap:"spine", left:24, top:90},
  derm_L4L5:{wrap:"derm", left:50, top:62},
  derm_S1:{wrap:"derm", left:50, top:80},

  knee_med:{wrap:"lower", left:44, top:44},
  knee_lat:{wrap:"lower", left:56, top:44},
  knee_ant:{wrap:"lower", left:50, top:40},
  knee_post:{wrap:"lower", left:50, top:48},

  hip_inguine:{wrap:"lower", left:50, top:28},
  hip_lat:{wrap:"lower", left:58, top:30},
  hip_gluteo:{wrap:"lower", left:50, top:32},

  shoulder_ant:{wrap:"upper", left:22, top:16},
  shoulder_lat:{wrap:"upper", left:20, top:18},
  shoulder_post:{wrap:"upper", left:18, top:16},

  hand_thumb:{wrap:"upper", left:76, top:78},
  hand_index:{wrap:"upper", left:74, top:74},
  hand_middle:{wrap:"upper", left:72, top:70},
  hand_ulnar:{wrap:"upper", left:66, top:72}
};

function wrapEl(name){
  if(name==="derm") return $("wrapDerm");
  if(name==="spine") return $("wrapSpine");
  if(name==="lower") return $("wrapLower");
  if(name==="upper") return $("wrapUpper");
  return $("wrapDerm");
}

function clearMarkers(){
  ["wrapDerm","wrapSpine","wrapLower","wrapUpper"].forEach(id=>{
    const w = $(id);
    [...w.querySelectorAll(".marker")].forEach(m=>m.remove());
  });
}

function addMarker(key, meta){
  const def = POS[key];
  if(!def) return;
  const m = document.createElement("div");
  m.className="marker show";
  m.style.left = def.left + "%";
  m.style.top  = def.top + "%";
  m.innerHTML = `
    <div class="dot"></div>
    <div class="label">
      ${meta.title}
      ${meta.sub ? `<small>${meta.sub}</small>` : ``}
    </div>
  `;
  m.addEventListener("click",(e)=>{ e.stopPropagation(); openModal(meta); });
  wrapEl(def.wrap).appendChild(m);
}

/* ========= Plan (logica) ========= */
function planFor(area, zone){
  if(area==="ginocchio"){
    const pain =
      zone==="mediale" ? "knee_med" :
      zone==="laterale" ? "knee_lat" :
      zone==="anteriore" ? "knee_ant" : "knee_post";

    return {
      dermView:"back",
      markers:[
        ["spine_L4L5", metaPoint("Prima applicazione: L4–L5",
          ["L4–L5","colonna","controllo segmentario"],
          `
          <p><b>Perché L4–L5 come primo punto:</b> è un riferimento segmentario chiave per la regolazione del controllo dell’arto inferiore. In pratica stai “centrando” la base lombopelvica prima di lavorare sulle compensazioni periferiche.</p>
          <p><b>Riferimento palpatorio:</b> linea creste iliache ≈ L4. Lo spazio <b>L4–L5</b> è subito sotto.</p>
          `
        )],
        ["derm_L4L5", metaPoint("L4–L5 (guida sulla mappa)",
          ["L4–L5","dermatomeri"],
          `<p>Vista regionale: serve solo come orientamento visivo.</p>`,
          "Guida regionale lombare"
        )],
        ["spine_S1", metaPoint("Seconda applicazione: S1 (sacro)",
          ["S1","bacino","catena posteriore"],
          `<p><b>Obiettivo:</b> stabilizzare la base sacrale e ridurre compensi sul ginocchio.</p>`,
          "Riferimento sacrale"
        )],
        ["derm_S1", metaPoint("S1 (guida sulla mappa)",
          ["S1","dermatomeri"],
          `<p>Orientamento visivo S1.</p>`,
          "Guida regionale sacrale"
        )],
        [pain, metaPoint("Zona dolore selezionata",
          ["dolore","arto inferiore"],
          `<p>Marker di orientamento sulla zona riferita dal paziente.</p>`,
          "Marker dolore"
        )]
      ]
    };
  }

  if(area==="anca"){
    const pain = zone==="inguine" ? "hip_inguine" : zone==="laterale" ? "hip_lat" : "hip_gluteo";
    return {
      dermView:"back",
      markers:[
        ["spine_L4L5", metaPoint("Prima applicazione: L4–L5",
          ["L4–L5","anca"],
          `<p>Riferimento lombopelvico utile per modulare pattern dell’arto inferiore.</p>`
        )],
        ["derm_L4L5", metaPoint("L4–L5 (guida mappa)",
          ["L4–L5","dermatomeri"],
          `<p>Orientamento regionale.</p>`,
          "Guida mappa"
        )],
        [pain, metaPoint("Zona dolore selezionata (anca)",
          ["dolore","anca"],
          `<p>Marker di orientamento sulla zona riferita.</p>`,
          "Marker dolore"
        )]
      ]
    };
  }

  if(area==="lombare"){
    return {
      dermView:"back",
      markers:[
        ["spine_L4L5", metaPoint("Prima applicazione: L4–L5",
          ["L4–L5","lombare"],
          `<p>Guida su tratto lombare basso con riferimento palpatorio.</p>`
        )],
        ["derm_L4L5", metaPoint("L4–L5 (guida mappa)",
          ["L4–L5","dermatomeri"],
          `<p>Orientamento regionale.</p>`,
          "Guida mappa"
        )],
        ["spine_S1", metaPoint("Seconda applicazione: S1 (se base sacrale coinvolta)",
          ["S1","sacro"],
          `<p>Utile se il dolore scende verso sacro/area SI.</p>`
        )]
      ]
    };
  }

  if(area==="spalla"){
    const pain = zone==="anteriore" ? "shoulder_ant" : zone==="laterale" ? "shoulder_lat" : "shoulder_post";
    return {
      dermView:"upper",
      markers:[
        [pain, metaPoint("Zona dolore selezionata (spalla)",
          ["dolore","arto superiore"],
          `<p>Marker di orientamento sulla zona riferita.</p>`,
          "Marker dolore"
        )]
      ]
    };
  }

  if(area==="mano"){
    const pain =
      zone==="pollice" ? "hand_thumb" :
      zone==="indice" ? "hand_index" :
      zone==="medio" ? "hand_middle" : "hand_ulnar";
    return {
      dermView:"upper",
      markers:[
        [pain, metaPoint("Zona dolore selezionata (mano/dita)",
          ["dolore","eccesso di carico locale"],
          `<p>Marker di orientamento sulla zona riferita.</p>`,
          "Marker dolore"
        )]
      ]
    };
  }

  if(area==="cervicale"){
    return {
      dermView:"back",
      markers:[]
    };
  }

  return { dermView:"back", markers:[] };
}

function metaPoint(title, chips, bodyHtml, sub){
  return { title, chips, bodyHtml, sub: sub || "Tocca per dettagli" };
}

/* ========= Render plan ========= */
function renderPlan(plan){
  clearMarkers();
  setMapImages(plan.dermView);
  plan.markers.forEach(([key, meta])=>addMarker(key, meta));
}

/* ========= Summary + safety ========= */
function summaryText(){
  const lines = [
    `Area: ${STATE.area}`,
    `Lato: ${STATE.side}`,
    `Zona: ${STATE.zoneLabel || "—"}`,
    `Intensità: ${STATE.intensity}`,
    `Durata: ${STATE.duration}`,
    STATE.notes.trim() ? `Note: ${STATE.notes.trim()}` : `Note: —`,
    ``,
    `Tocca i marker per aprire la scheda del punto.`
  ];
  if(STATE.area==="ginocchio"){
    lines.push(``, `Ordine consigliato: 1) L4–L5  2) S1  3) Zona dolore (orientamento)`);
  }
  return lines.join("\n");
}

function setSafety(){
  const n = Number(STATE.intensity);
  const warn = [];
  if(!isNaN(n) && n>=8) warn.push("Dolore molto intenso (8–10): valuta un consulto medico.");
  const box = $("safety");
  if(warn.length){
    box.style.display="block";
    box.innerHTML = `<b>Attenzione:</b><ul>${warn.map(w=>`<li>${w}</li>`).join("")}</ul>`;
  } else {
    box.style.display="none";
    box.innerHTML = "";
  }
}

/* ========= Eventi ========= */
$("btnNext1").addEventListener("click", ()=>{
  const area = $("area").value;
  const side = $("side").value;
  if(!area || !side){ alert("Seleziona area e lato."); return; }
  STATE.area = area; STATE.side = side;
  STATE.zone = ""; STATE.zoneLabel = "";
  renderZones(area);
  showStep(2);
});

$("btnBack2").addEventListener("click", ()=>showStep(1));
$("btnNext2").addEventListener("click", ()=>{
  if(!STATE.zone){ alert("Seleziona una zona."); return; }
  showStep(3);
});

$("btnBack3").addEventListener("click", ()=>showStep(2));
$("btnNext3").addEventListener("click", ()=>{
  const intensity = $("intensity").value;
  const duration  = $("duration").value;
  const notes     = $("notes").value || "";
  const n = Number(intensity);

  if(intensity==="" || isNaN(n) || n<0 || n>10){ alert("Inserisci intensità 0–10."); return; }
  if(!duration){ alert("Seleziona la durata."); return; }

  STATE.intensity = intensity;
  STATE.duration  = duration;
  STATE.notes     = notes;

  STATE.plan = planFor(STATE.area, STATE.zone);
  $("summary").textContent = summaryText();
  setSafety();

  renderPlan(STATE.plan);
  showStep(4);
});

$("btnRestart").addEventListener("click", ()=>{
  Object.assign(STATE, { area:"", side:"", zone:"", zoneLabel:"", intensity:"", duration:"", notes:"", plan:null });
  $("area").value=""; $("side").value="";
  $("zones").innerHTML="";
  $("intensity").value=""; $("duration").value=""; $("notes").value="";
  $("summary").textContent="";
  $("safety").style.display="none"; $("safety").innerHTML="";
  clearMarkers();
  showStep(1);
});

$("btnCopy").addEventListener("click", async ()=>{
  const t = $("summary").textContent || "";
  if(!t){ alert("Nulla da copiare."); return; }
  try{ await navigator.clipboard.writeText(t); alert("Testo copiato."); }
  catch(e){ alert("Copia non disponibile. Seleziona e copia manualmente."); }
});

$("modalClose").addEventListener("click", closeModal);
$("modalBack").addEventListener("click", (e)=>{ if(e.target === $("modalBack")) closeModal(); });

showStep(1);
</script>
</body>
</html>




